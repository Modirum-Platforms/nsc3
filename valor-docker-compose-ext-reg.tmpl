### ReleaseTagStart latest gpu
# This is for nsc3 version 3.4 and later
version: "3"
services:
  nsc-analytics-db:
    container_name: nsc-analytics-db
    image: $NSC3REG/nsc-analytics-db:$NSC3REL
    networks:
        nsc-network:
            ipv4_address: "172.18.0.23"
    restart: unless-stopped
    volumes:
        - analytics-postgres-volume:/var/lib/postgresql/data:rw
  nsc-analytics-bus-gpu:
    container_name: nsc-analytics-bus-gpu
    runtime: nvidia
    image: $NSC3REG/nsc-analytics-bus-gpu:$NSC3REL
    environment:
        - PYTHONUNBUFFERED=1
        - NVIDIA_VISIBLE_DEVICES=all
        - NVIDIA_DRIVER_CAPABILITIES=all
    networks:
        nsc-network:
            ipv4_address: "172.18.0.21"
    depends_on:
        - "analytics-db"
    restart: unless-stopped
  nsc-analytics-tasker-service:
    container_name: nsc-analytics-tasker-service
    image: $NSC3REG/nsc-analytics-tasker-service:$NSC3REL
    networks:
        nsc-network:
            ipv4_address: "172.18.0.22" 
    depends_on:
        - "analytics-bus"
        - "analytics-db"
    restart: unless-stopped
  nsc-analytics-cookbook:
    container_name: nsc-analytics-cookbook
    image: $NSC3REG/nsc-analytics-cookbook:$NSC3REL
    networks:
        - nsc-network
    depends_on:
        - "analytics-bus"
        - "tasker"
        - "analytics-db"
    environment:
        - RECIPE_NAMES=yolo,droneyolo,ocr
        - MODELRUNNER_DEVICE=GPU
volumes:
  analytics-postgres-volume:
networks:
  nsc-network:
    external:
      name: "nsc-network"
 
### ReleaseTagEnd latest gpu
### ReleaseTagStart latest cpu
# This is for nsc3 version 3.4 and later
version: "3"
services:
  nsc-analytics-db:
    container_name: nsc-analytics-db
    image: $NSC3REG/nsc-analytics-db:$NSC3REL
    networks:
        nsc-network:
            ipv4_address: "172.18.0.23"
    restart: unless-stopped
    volumes:
        - analytics-postgres-volume:/var/lib/postgresql/data:rw
  nsc-analytics-bus-cpu:
    container_name: nsc-analytics-bus-cpu
    runtime: nvidia
    image: $NSC3REG/nsc-analytics-bus-cpu:$NSC3REL
    environment:
        - PYTHONUNBUFFERED=1
        - NVIDIA_VISIBLE_DEVICES=all
        - NVIDIA_DRIVER_CAPABILITIES=all
    networks:
        nsc-network:
            ipv4_address: "172.18.0.21"
    depends_on:
        - "analytics-db"
    restart: unless-stopped
  nsc-analytics-tasker-service:
    container_name: nsc-analytics-tasker-service
    image: $NSC3REG/nsc-analytics-tasker-service:$NSC3REL
    networks:
        nsc-network:
            ipv4_address: "172.18.0.22" 
    depends_on:
        - "analytics-bus"
        - "analytics-db"
    restart: unless-stopped
  nsc-analytics-cookbook:
    container_name: nsc-analytics-cookbook
    image: $NSC3REG/nsc-analytics-cookbook:$NSC3REL
    networks:
        - nsc-network
    depends_on:
        - "analytics-bus"
        - "tasker"
        - "analytics-db"
    environment:
        - RECIPE_NAMES=yolo,droneyolo,ocr
        - MODELRUNNER_DEVICE=CPU
volumes:
  analytics-postgres-volume:
networks:
  nsc-network:
    external:
      name: "nsc-network"
 
 ### ReleaseTagEnd latest cpu
